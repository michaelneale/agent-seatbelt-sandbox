;; Sandbox profile: allow everything EXCEPT direct outbound network.
;; The process can only reach the network via localhost (where our proxy lives).
;; All child processes inherit this restriction.

(version 1)
(allow default)

;; Block all network, then poke holes for localhost + DNS
(deny network*)

;; DNS resolution via macOS system resolver (mDNSResponder)
(allow network-outbound (literal "/private/var/run/mDNSResponder"))

;; Unix domain sockets (used by various local services)
(allow network-outbound (remote unix-socket))

;; Localhost only â€” this is the only way out, through our proxy
(allow network-outbound (remote ip "localhost:*"))

;; Allow network-inbound on localhost (for local dev servers, LSPs, etc.)
(allow network-inbound (local ip "localhost:*"))
